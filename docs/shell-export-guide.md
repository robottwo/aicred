# Shell Export Guide

The `aicred export` command allows you to export discovered AI API keys and configurations as shell environment variables with flexible template support.

## Basic Usage

Export all discovered provider configurations:

```bash
aicred export
```

This will generate shell export statements for bash:

```bash
# AI API Keys - Generated by aicred
# Do not commit to version control!

export OPENAI_API_KEY='sk-***'
export ANTHROPIC_API_KEY='sk-ant-***'
export GOOGLE_API_KEY='AIza***'
```

## Output Formats

Export to different shell formats:

```bash
# Bash (default)
aicred export --format bash

# Fish
aicred export --format fish

# PowerShell
aicred export --format powershell
```

## Custom Templates

Create a custom template file `my-template.yaml`:

```yaml
header: |
  My AI Configuration
  Generated: {{var.date}}

variables:
  - name: OPENAI_API_KEY
    value: "{{openai.api_key}}"
    description: OpenAI API key for GPT models
    required: false

  - name: ANTHROPIC_API_KEY
    value: "{{anthropic.api_key}}"
    description: Anthropic API key for Claude models
    required: false

  - name: AI_PROVIDER
    value: "{{var.default_provider}}"
    description: Default AI provider to use
    required: false

footer: |
  Configuration loaded - ready to use!
```

Use the custom template:

```bash
aicred export --template my-template.yaml --vars date=$(date +%Y-%m-%d) --vars default_provider=openai
```

## Variables

### Template Placeholders

Templates support two types of placeholders:

1. **Provider variables**: `{{provider_name.key}}`
   - `{{openai.api_key}}` - OpenAI API key
   - `{{anthropic.api_key}}` - Anthropic API key
   - `{{google.api_key}}` - Google AI API key
   - `{{provider_name.base_url}}` - Custom base URL
   - `{{provider_name.id}}` - Instance ID

2. **Custom variables**: `{{var.variable_name}}`
   - Custom variables passed via `--vars NAME=VALUE`

### Available Provider Keys

Based on discovered configurations, you may have access to:
- `openai.api_key`, `openai.base_url`, `openai.id`
- `anthropic.api_key`, `anthropic.base_url`, `anthropic.id`
- `google.api_key`, `google.base_url`, `google.id`
- And any other provider configured in your aicred config

## Prefix Variables

Add a prefix to all exported variables:

```bash
aicred export --prefix AI

# Results in:
export AI_OPENAI_API_KEY='sk-***'
export AI_ANTHROPIC_API_KEY='sk-ant-***'
```

## Write to File

Export to a file instead of stdout:

```bash
aicred export --output ~/.config/ai-env.sh
aicred export --template my-template.yaml --output ~/ai-config.sh
```

## Include Secret Values

⚠️ **WARNING**: Use with caution! This outputs full secret values.

```bash
aicred export --include-secrets

# Results in:
export OPENAI_API_KEY='sk-proj-1234567890abcdef1234567890abcdef'
```

## Dry Run

Preview export without writing to file:

```bash
aicred export --dry-run
aicred export --output ~/.config/ai-env.sh --dry-run
```

## Integration Examples

### Source in Bash Profile

```bash
# Add to ~/.bashrc or ~/.zshrc
eval "$(aicred export)"
```

### Load in Fish Shell

```bash
# Add to ~/.config/fish/config.fish
aicred export --format fish | source
```

### Load in PowerShell Profile

```powershell
# Add to $PROFILE
aicred export --format powershell | Invoke-Expression
```

### Docker Integration

```bash
# Export to file and source in Docker
aicred export --output docker-env.sh
source docker-env.sh

# Or use directly
eval "$(aicred export)"
docker run --env-file <(aicred export) my-image
```

### Development Environment

```bash
# Create a custom dev environment template
cat > dev-template.yaml << EOF
header: |
  Development Environment
  DO NOT USE IN PRODUCTION

variables:
  - name: DEV_OPENAI_KEY
    value: "{{openai.api_key}}"
    description: OpenAI key for development

  - name: DEV_ANTHROPIC_KEY
    value: "{{anthropic.api_key}}"
    description: Anthropic key for development

  - name: ENVIRONMENT
    value: "development"
    description: Current environment
    required: true
EOF

# Export development configuration
aicred export --template dev-template.yaml --output ~/.dev-env.sh
```

## Template Reference

### Template Structure

```yaml
header: "Optional header text as a multi-line string"

variables:
  - name: VARIABLE_NAME
    value: "template value with {{placeholders}}"
    description: "Optional description"
    required: true/false

footer: "Optional footer text"
```

### Template Variables

Each variable definition supports:

- `name` (required): Variable name to export
- `value` (required): Template value with placeholders
- `description` (optional): Comment to include below the export statement
- `required` (optional): If true, the variable should always have a value (default: false)

### Value Placeholders

Replace `{{provider.key}}` with actual values:

- `{{openai.api_key}}` → actual OpenAI API key
- `{{anthropic.api_key}}` → actual Anthropic API key
- `{{var.CUSTOM_VAR}}` → custom variable from `--vars` flag

## Security Best Practices

1. **Never commit export files** with actual secrets
2. **Use `.gitignore`**: Add `*.env.sh`, `ai-config.sh`, etc.
3. **Use dry-run**: Preview exports before writing to files
4. **File permissions**: Set `chmod 600` on export files
5. **Avoid `--include-secrets`**: Only use when absolutely necessary

```bash
# Set secure permissions
aicred export --output ~/.private-ai-env.sh
chmod 600 ~/.private-ai-env.sh
```

## Troubleshooting

### No Variables Exported

If no variables are exported, check that:
1. You have provider configurations in `~/.config/aicred/instances.yaml`
2. The provider keys in your template match your configured providers
3. API keys are present in your provider instances

### Template Parse Errors

Ensure your YAML is valid:
- Use proper indentation (2 spaces recommended)
- Quote strings with special characters
- Use `|` for multi-line strings

```bash
# Validate YAML syntax
python3 -c "import yaml; yaml.safe_load(open('my-template.yaml'))"
```

### Format Issues

Make sure you're using the correct format for your shell:
- Bash: `--format bash`
- Fish: `--format fish`
- PowerShell: `--format powershell` or `--format pwsh`
